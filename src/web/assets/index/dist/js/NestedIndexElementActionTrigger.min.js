Craft.NestedIndexElementActionTrigger=Garnish.Base.extend({maxLevels:null,newChildUrl:null,$trigger:null,$selectedItems:null,triggerEnabled:true,elementIndex:null,init:function(elementIndex,settings){this.elementIndex=elementIndex;this.setSettings(settings,Craft.ElementActionTrigger.defaults);this.$trigger=$("#"+settings.type.replace(/[\[\]\\]+/g,"-")+"-actiontrigger");if(this.settings.activate){this.$trigger.data("custom-handler",true);if(this.$trigger.prop("nodeName")==="FORM"){this.addListener(this.$trigger,"submit","handleTriggerActivation")}else{this.addListener(this.$trigger,"click","handleTriggerActivation")}}this.updateTrigger();this.elementIndex.on("selectionChange",$.proxy(this,"updateTrigger"))},updateTrigger:function(){if(this.elementIndex.getSelectedElements().length===0){return}if(this.validateSelection()){this.enableTrigger()}else{this.disableTrigger()}},validateSelection:function(){var valid=true;this.$selectedItems=this.elementIndex.getSelectedElements();if(!this.settings.batch&&this.$selectedItems.length>1){valid=false}else if(typeof this.settings.validateSelection==="function"){valid=this.settings.validateSelection(this.$selectedItems)}return valid},enableTrigger:function(){if(this.triggerEnabled){return}this.$trigger.removeClass("disabled");this.triggerEnabled=true},disableTrigger:function(){if(!this.triggerEnabled){return}this.$trigger.addClass("disabled");this.triggerEnabled=false},handleTriggerActivation:function(ev){ev.preventDefault();ev.stopPropagation();if(this.triggerEnabled){this.settings.activate(this.$selectedItems)}}},{defaults:{type:null,batch:true,validateSelection:null,activate:null}});